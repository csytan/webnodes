{% extends "base.html" %}


{% block title %}
    <title>{{ escape(current_site.title) }} | Submit a Topic</title>
{% end %}


{% block style %}
    <style>
        #title { width: 550px; }
        textarea {
            height: 300px;
            width: 100%;
        }
        #slug {
            display: inline; 
            width: 300px;
            border: none;
            background: #eee;
        }
        .slug { font-size: 0.9em; color: grey; }
    </style>
{% end %}


{% block script %}
    <script>
        function slugify(val) {
            return $.trim(val.replace(/[^\w\s-]/g, ''))
                .replace(/[-\s]+/g, '-')
                .toLowerCase()
                .substr(0, 60);
        }
        
        jQuery(function($){
            $('#title').focus()
                .keyup(function(){
                    $('#slug').val(slugify(this.value));
                });
            $('#slug').keyup(function(){
                var slug = slugify(this.value);
                if (this.value != slug)
                    this.value = slug;
            });
        });
    </script>
{% end %}


{% block content %}
    {% set message = handler.get_argument('message', None) %}
    {% if message == 'no_title' %}
        <div id="message" class="error">Missing a title</div>
    {% elif message == 'check_slug' %}
        <div id="message" class="error">Please check that the topic URL is correct.</div>
    {% elif message == 'no_text' %}
        <div id="message" class="error">Please enter some text for your topic.</div>
    {% elif message == 'topic_exists' %}
        <div id="message" class="error">A topic already exists with that URL. Please choose a different name.</div>
    {% end %}
    
    <h1>Submit a Topic</h1>
    
    <p>
        First time posting? Read the <a href="/community">Community Guidelines</a>.
    </p>
    <form action="/submit" method="post">
        {{ xsrf_form_html() }}
        <label for="title">Title</label>
        <input id="title" type="text" name="title" value="{{ handler.get_argument('title', '') }}" tabindex="1">
        <p class="slug">
            {{ current_site.domain or current_site.key_name + '.webnodes.org' }}/<input id="slug" type="text" name="slug" value="{{ handler.get_argument('slug', '') }}" tabindex="2">
        </p>
        <label for="text">
            Text (<a target="_blank" href="http://daringfireball.net/projects/markdown/basics">markdown</a>)
        </label>
        <textarea name="text" tabindex="4">{{ handler.get_argument('text', '') }}</textarea>
        <input type="submit" value="Do it!" tabindex="5">
    </form>
{% end %}
